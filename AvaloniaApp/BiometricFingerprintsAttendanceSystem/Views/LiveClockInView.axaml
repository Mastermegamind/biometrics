<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BiometricFingerprintsAttendanceSystem.ViewModels"
             x:Class="BiometricFingerprintsAttendanceSystem.Views.LiveClockInView"
             x:DataType="vm:LiveClockInViewModel">

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">

        <!-- Header -->
        <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,30">
            <TextBlock Text="Clock In"
                       FontSize="32" FontWeight="Bold"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding CurrentDate}"
                       FontSize="16" Foreground="Gray"
                       HorizontalAlignment="Center" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding CurrentTime}"
                       FontSize="48" FontWeight="Light"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*">

            <!-- Fingerprint Scanner Panel -->
            <Border Grid.Column="0"
                    Background="#F0F0F0"
                    CornerRadius="15"
                    Padding="30"
                    Margin="0,0,20,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Fingerprint Scanner"
                               FontWeight="Bold" FontSize="18"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,20"/>

                    <!-- Scanner Visual -->
                    <Border Width="200" Height="250"
                            Background="#E0E0E0"
                            CornerRadius="10"
                            BorderBrush="#CCCCCC"
                            BorderThickness="2">
                        <Grid>
                            <Image Source="{Binding FingerprintImage}"
                                   Stretch="Uniform"
                                   Margin="15"/>
                            <StackPanel VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        IsVisible="{Binding FingerprintImage, Converter={x:Static ObjectConverters.IsNull}}">
                                <PathIcon Data="M12 1C8.14 1 5 4.14 5 8c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-3.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"
                                          Width="60" Height="60"
                                          Foreground="#AAAAAA"/>
                                <TextBlock Text="Place finger here"
                                           Foreground="Gray"
                                           HorizontalAlignment="Center"
                                           Margin="0,10,0,0"/>
                            </StackPanel>

                            <!-- Processing Indicator -->
                            <Border Background="#80000000"
                                    CornerRadius="10"
                                    IsVisible="{Binding IsProcessing}">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <ProgressBar IsIndeterminate="True"
                                                 Width="100"
                                                 Margin="0,0,0,10"/>
                                    <TextBlock Text="Processing..."
                                               Foreground="White"
                                               HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>

                </StackPanel>
            </Border>

            <!-- Arrow -->
            <TextBlock Grid.Column="1"
                       Text="â†’"
                       FontSize="48"
                       VerticalAlignment="Center"
                       Foreground="Gray"
                       IsVisible="{Binding ShowResult}"/>

            <!-- Result Panel -->
            <Border Grid.Column="2"
                    Background="{Binding IsSuccess, Converter={StaticResource BoolToSuccessBackgroundConverter}}"
                    CornerRadius="15"
                    Padding="30"
                    Margin="20,0,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    IsVisible="{Binding ShowResult}">
                <StackPanel HorizontalAlignment="Center">
                    <!-- Success/Fail Icon -->
                    <Border Width="80" Height="80"
                            CornerRadius="40"
                            Background="{Binding IsSuccess, Converter={StaticResource BoolToSuccessColorConverter}}"
                            HorizontalAlignment="Center"
                            Margin="0,0,0,15">
                        <TextBlock Text="{Binding IsSuccess, Converter={StaticResource BoolToCheckmarkConverter}}"
                                   FontSize="40"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>

                    <!-- Student Photo -->
                    <Border Width="120" Height="120"
                            CornerRadius="60"
                            ClipToBounds="True"
                            Background="#E0E0E0"
                            HorizontalAlignment="Center"
                            Margin="0,0,0,15"
                            IsVisible="{Binding IsSuccess}">
                        <Image Source="{Binding StudentPhoto}"
                               Stretch="UniformToFill"/>
                    </Border>

                    <!-- Student Info -->
                    <TextBlock Text="{Binding StudentName}"
                               FontSize="24" FontWeight="Bold"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="250"/>

                    <TextBlock Text="{Binding StudentRegNo}"
                               FontSize="16"
                               Foreground="Gray"
                               HorizontalAlignment="Center"
                               Margin="0,5,0,0"/>

                    <TextBlock Text="{Binding StudentClass}"
                               FontSize="14"
                               HorizontalAlignment="Center"
                               Margin="0,5,0,15"/>

                    <!-- Clock In Time -->
                    <Border Background="#333"
                            CornerRadius="5"
                            Padding="20,10"
                            IsVisible="{Binding IsSuccess}">
                        <StackPanel>
                            <TextBlock Text="Clocked In At"
                                       FontSize="12"
                                       Foreground="#AAA"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding ClockInTime}"
                                       FontSize="28" FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Reset Button -->
                    <Button Content="Next Person"
                            Command="{Binding ResetCommand}"
                            HorizontalAlignment="Center"
                            Padding="30,12"
                            Margin="0,20,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Footer: Status Bar -->
        <Border Grid.Row="2"
                Background="#333"
                CornerRadius="5"
                Padding="15,10"
                Margin="0,30,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           Foreground="White"
                           FontSize="14"
                           VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <StackPanel Orientation="Vertical" Margin="0,0,15,0">
                        <TextBlock Text="{Binding TemplateCacheStatus}"
                                   Foreground="#AAA"
                                   FontSize="11"/>
                        <TextBlock Text="{Binding TemplateCacheLastRefresh}"
                                   Foreground="#888"
                                   FontSize="10"/>
                        <TextBlock Text="{Binding TemplateCacheHint}"
                                   Foreground="#F59E0B"
                                   FontSize="10"
                                   TextWrapping="Wrap"
                                   MaxWidth="220"
                                   IsVisible="{Binding ShowTemplateCacheHint}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding SyncModeDisplay}"
                               Foreground="#AAA"
                               FontSize="12"
                               Margin="0,0,15,0"/>
                    <Ellipse Width="10" Height="10"
                             Fill="{Binding IsOnline, Converter={StaticResource BoolToOnlineColorConverter}}"
                             Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding IsOnline, Converter={StaticResource BoolToOnlineTextConverter}}"
                               Foreground="White"
                               FontSize="12"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
